# DNS域名解析过程 

我们都知道在浏览器通过域名发起一个网络请求的时候，会有DNS服务器将域名解析成ip地址，以便向正确的ip地址发送请求，那么这一个过程具体是怎么处理的呢？今天整理了一下DNS域名解析的过程。大致分为10步：



### 第一步

浏览器会检查缓存中有没有域名对应的ip地址，这个缓存是有过期时长的，一般是几分钟到几小时不等。

### 第二步

如果浏览器缓存没有，那么就检查操作系统的hosts文件，比如windows就是C:\Windows\System32\drivers\etc\hosts文件，linux在/etc/hosts文件中配置。

### 第三步

如果本地也没有配置那么就会根据向本机配置的本地区DNS域名服务器（LDNS）发起请求，如果你是通过学校连接互联网的一般是你学校的DNS服务器，如果你是在小区连接互联网的一般是网络提供商比如电信，联通的DNS服务器，DNS服务器通常不会太远。如何查看本机的域名服务器，在Linux可以通过 cat /etc/resolv.conf查看。到这一步基本能解析80%的域名。

### 第四步

如果LDNS也不能解析，那么就直接到根域名服务器请求解析。

### 第五步

根域名服务器会给本地域名服务器LDNS一个所查询的主域名服务器（gTLD）地址，gTLD是国际顶级域名服务器，比如.com,.cn,.org等。

### 第六步

本地域名服务器LDNS再向上一步返回的gLTD服务器发送请求。

### 第七步

gLTD服务器查询并返回域名对应的Name Server域名服务器的地址，通常是你注册的域名服务器，例如你在某个域名服务器提供商申请的域名，那么这个域名解析任务就由这个域名服务提供商来完成。

### 第八步

Name Server域名服务器会查询存储的域名和ip的映射关系表，将ip连同一个TTL值返回给DNS Server域名服务器。

### 第九步

LDNS拿到ip和TTL会缓存起来，缓存时间由TTL值控制。

### 第十步

把解析的结果返回给用户，用户根据TTL值缓存在本地系统缓存中，域名解析过程结束。

整个过程用一张图来表示：

![img](http://api.fly63.com/vue_blog/public/Uploads/20190220/5c6d64e0e66d6.jpg)

在实际解析过程中可能不只有这10个步骤，入Name Server也有可能有多级或者一个GTM来控制负载均衡，都能影响DNS解析过程。

